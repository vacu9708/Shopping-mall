<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <button onclick="login()">login</button>
    <input type="file" id="imageInput" onChange="onImageChange()">
    <img alt="image" id="downloadedImage">
    <script>
        function login() {
            const userData = {
                username: "admin",
                password: "123"
            }
            axios.post('user_management/login', userData)
            .then(response => {
                console.log(response.data);
                sessionStorage.setItem("accessToken", response.data.accessToken)
                sessionStorage.setItem("refreshToken", response.data.refreshToken)
            })
        }

        const onImageChange = async () => {
            const productImg = document.getElementById("imageInput").files[0];
            // convert the image to base64
            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => resolve(reader.result);
                reader.onerror = reject;
            });
            const base64Image = (await toBase64(productImg)).split('base64,')[1];

            const newProductDto = {
                name: "new product4",
                description: "new product description",
                price: 1000,
                stock: 100,
                productImg: base64Image,
                productImgSize: productImg.size
            }

            axios.post('product_management/manager/addProduct', newProductDto, {
                headers: {
                    'accessToken': sessionStorage.getItem('accessToken')
                }
            })
            .then(response => {
                console.log(response.data);
                // downloadImage();
            })
        }
        // Using FormData
        // const onImageChange2 = async () => {
        //     const productImg = document.getElementById("imageInput").files[0];

        //     // FormData
        //     const formData = new FormData();
        //     formData.append('productImg', productImg);

        //     const newProductDto = {
        //         name: "new product3",
        //         description: "new product description",
        //         price: 1000,
        //         stock: 100,
        //     }
        //     formData.append('newProductDto', JSON.stringify(newProductDto));

        //     axios.post('product_management/addProduct', formData, {
        //         headers: {
        //             'accessToken': sessionStorage.getItem('accessToken'),
        //             'Content-Type': 'application/json'
        //         }
        //     })
        //     .then(response => {
        //         console.log(response.data);
        //         // downloadImage();
        //     })
        // }

        function downloadImage() {
            axios.get('/download')
            .then(response => {
                // console.log(response.data);
                const image = document.getElementById("downloadedImage");
                const base64Image = response.data.image;
                document.getElementById('downloadedImage').src = `data:image/jpeg;base64,${base64Image}`;
            })
        }
    </script>
</body>
</html>