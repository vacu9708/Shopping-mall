<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Upload products</h1>
    <span>Password: </span> <input type="text" id="password"><br>
    <!-- ProductDto -->
    <span>Name: </span> <input type="text" id="name"><br>
    <span>Description</span> <input type="text" id="description"><br>
    <span>Price</span> <input type="text" id="price"><br>
    <span>Stock</span> <input type="text" id="stock"><br>
    <span>Product image</span> <input type="file" id="imageInput" onChange="onImageChange()"><br>
    <!-- <img alt="image" id="downloadedImage"> -->
    <script>
        const onImageChange = async () => {
            const productImg = document.getElementById("imageInput").files[0];
            // convert the image to base64
            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => resolve(reader.result);
                reader.onerror = reject;
            });
            const base64Image = (await toBase64(productImg)).split('base64,')[1];

            const newProductDto = {
                name: document.getElementById("name").value,
                description: document.getElementById("description").value,
                price: document.getElementById("price").value,
                stock: document.getElementById("stock").value,
                image: base64Image
            }

            axios.post('product_management/manager/addProduct', newProductDto, {
                headers: {
                    'password': document.getElementById("password").value
                }
            })
            .then(response => {
                console.log(response.data);
                // downloadImage();
            })
        }
        // Using FormData
        // const onImageChange2 = async () => {
        //     const productImg = document.getElementById("imageInput").files[0];

        //     // FormData
        //     const formData = new FormData();
        //     formData.append('productImg', productImg);

        //     const newProductDto = {
        //         name: "new product3",
        //         description: "new product description",
        //         price: 1000,
        //         stock: 100,
        //     }
        //     formData.append('newProductDto', JSON.stringify(newProductDto));

        //     axios.post('product_management/addProduct', formData, {
        //         headers: {
        //             'accessToken': sessionStorage.getItem('accessToken'),
        //             'Content-Type': 'application/json'
        //         }
        //     })
        //     .then(response => {
        //         console.log(response.data);
        //         // downloadImage();
        //     })
        // }

        function downloadImage() {
            axios.get('/download')
            .then(response => {
                // console.log(response.data);
                const image = document.getElementById("downloadedImage");
                const base64Image = response.data.image;
                document.getElementById('downloadedImage').src = `data:image/jpeg;base64,${base64Image}`;
            })
        }
    </script>
</body>
</html>